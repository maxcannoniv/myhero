<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MyHERO — Terminal</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="terminal">

    <!-- ===== STATUS BAR (always visible) ===== -->
    <div class="status-bar">
      <div class="status-left">
        <span class="status-hero-name" id="statusHeroName">Hero Name</span>
        <span class="status-hero-class" id="statusHeroClass">Class</span>
      </div>
      <div class="status-right">
        <span class="status-stat" id="statusFollowers" title="Followers">&#9733; —</span>
        <span class="status-stat" id="statusNetWorth" title="Bank">&#36; —</span>
        <button class="status-logout" id="logoutBtn">&#9211;</button>
      </div>
    </div>

    <!-- ===== HOME SCREEN (app grid) ===== -->
    <div class="home-screen active" id="homeScreen">
      <div class="app-grid">

        <!-- Row 1: main feeds -->
        <div class="app-icon" data-app="myhero">
          <div class="app-icon-graphic" style="background: var(--accent-yellow);">&#9889;</div>
          <span class="app-icon-label">myHERO</span>
        </div>

        <div class="app-icon" data-app="bliink">
          <div class="app-icon-graphic" style="background: var(--accent-purple);">&#128065;</div>
          <span class="app-icon-label">Bliink</span>
        </div>

        <div class="app-icon" data-app="todaystidbit">
          <div class="app-icon-graphic" style="background: #2c2218;">&#128240;</div>
          <span class="app-icon-label">The Times</span>
        </div>

        <!-- Row 2: news/comms -->
        <div class="app-icon" data-app="dailydollar">
          <div class="app-icon-graphic" style="background: var(--accent-green);">&#36;</div>
          <span class="app-icon-label">Daily Dollar</span>
        </div>

        <div class="app-icon" data-app="streetview">
          <div class="app-icon-graphic" style="background: var(--accent-red);">&#128373;</div>
          <span class="app-icon-label">Streetview</span>
        </div>

        <div class="app-icon" data-app="messages">
          <div class="app-icon-graphic" style="background: var(--accent-blue);">&#9993;</div>
          <span class="app-icon-label">Messages</span>
        </div>

        <!-- Row 3: personal -->
        <div class="app-icon" data-app="profile">
          <div class="app-icon-graphic" style="background: #888;">&#9881;</div>
          <span class="app-icon-label">Profile</span>
        </div>

        <div class="app-icon" data-app="inventory">
          <div class="app-icon-graphic" style="background: #c97b2a;">&#127890;</div>
          <span class="app-icon-label">Inventory</span>
        </div>

        <div class="app-icon" data-app="notebook">
          <div class="app-icon-graphic" style="background: #e8d5b7; color: #333;">&#128221;</div>
          <span class="app-icon-label">Notebook</span>
        </div>

      </div>
    </div>

    <!-- ===== APP VIEWS (each opens full-screen below status bar) ===== -->

    <!-- myHERO App -->
    <div class="app-view" id="app-myhero">
      <div class="app-titlebar">
        <button class="app-home-btn" data-home>&larr; Home</button>
        <span class="app-titlebar-name">myHERO</span>
      </div>
      <div class="app-body app-body-myhero">
        <div id="feed-myhero">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </div>
    </div>

    <!-- Bliink App -->
    <div class="app-view" id="app-bliink">
      <div class="app-titlebar app-titlebar-bliink">
        <button class="app-home-btn" data-home>&larr; Home</button>
        <span class="app-titlebar-name">Bliink</span>
      </div>
      <div class="app-body app-body-bliink">

        <!-- New Post Button -->
        <div class="bl-new-post-bar">
          <button class="bl-new-post-btn" id="bliinkNewPostBtn">+ New Post</button>
        </div>

        <!-- Post Creator (hidden by default) -->
        <div class="bl-composer" id="bliinkComposer" style="display: none;">
          <div class="bl-composer-header">New Bliink Post</div>

          <!-- Step 1: Background picker -->
          <div class="bl-composer-label">Choose a background:</div>
          <div class="bl-preset-grid" id="bliinkBgGrid">
            <!-- Populated by JS -->
          </div>

          <!-- Step 2: Character cutout picker (optional) -->
          <div class="bl-composer-label">Add a character <span class="bl-optional">(optional)</span>:</div>
          <div class="bl-preset-grid" id="bliinkCutoutGrid">
            <!-- Populated by JS -->
          </div>

          <!-- Live preview: background + cutout layered -->
          <div class="bl-composer-preview" id="bliinkComposerPreview" style="display: none;">
            <div class="bl-preview-frame">
              <img class="bl-preview-bg" id="bliinkPreviewBg" src="" alt="">
              <img class="bl-preview-cutout" id="bliinkPreviewCutout" src="" alt="" style="display: none;">
            </div>
          </div>

          <!-- Caption -->
          <textarea class="bl-caption-input" id="bliinkCaption" placeholder="Write a caption..." maxlength="280" rows="3"></textarea>

          <!-- Actions -->
          <div class="bl-composer-actions">
            <button class="btn btn-secondary bl-cancel-btn" id="bliinkCancelBtn">Cancel</button>
            <button class="btn btn-primary bl-post-btn" id="bliinkPostBtn">Post</button>
          </div>
          <div class="error-msg" id="bliinkPostError"></div>
        </div>

        <!-- Feed -->
        <div id="feed-bliink">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </div>
    </div>

    <!-- Streetview App -->
    <div class="app-view" id="app-streetview">
      <div class="app-titlebar app-titlebar-streetview">
        <button class="app-home-btn" data-home>&larr; Home</button>
        <span class="app-titlebar-name">Streetview</span>
      </div>
      <div class="app-body app-body-streetview">
        <div id="feed-streetview">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </div>
    </div>

    <!-- Daily Dollar App -->
    <div class="app-view" id="app-dailydollar">
      <div class="app-titlebar app-titlebar-dailydollar">
        <button class="app-home-btn" data-home>&larr; Home</button>
        <span class="app-titlebar-name">Daily Dollar</span>
      </div>
      <div class="app-body app-body-dailydollar">
        <div id="feed-dailydollar">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </div>
    </div>

    <!-- Today's Tidbit App -->
    <div class="app-view" id="app-todaystidbit">
      <div class="app-titlebar app-titlebar-tidbit">
        <button class="app-home-btn" data-home>&larr; Home</button>
        <span class="app-titlebar-name">The Times Today</span>
      </div>
      <div class="app-body app-body-tidbit">
        <!-- Masthead — permanent banner at top of the paper -->
        <div class="tt-masthead">
          <div class="tt-masthead-name">The Times Today</div>
          <div class="tt-masthead-tagline">same time, different day</div>
        </div>
        <div id="feed-todaystidbit">
          <div class="loading"><div class="spinner"></div></div>
        </div>
      </div>
    </div>

    <!-- Messages App -->
    <div class="app-view" id="app-messages">
      <div class="app-titlebar">
        <button class="app-home-btn" data-home>&larr; Home</button>
        <span class="app-titlebar-name" id="messagesTitlebar">Messages</span>
      </div>
      <div class="app-body app-body-messages">

        <!-- INBOX VIEW (list of conversations) -->
        <div id="messagesInbox">
          <div class="msg-new-btn-bar">
            <button class="msg-new-btn" id="msgNewBtn">+ New Message</button>
          </div>
          <div id="inboxList">
            <div class="loading"><div class="spinner"></div></div>
          </div>
        </div>

        <!-- CONTACTS PICKER (for new message) -->
        <div id="messagesContacts" style="display: none;">
          <div class="msg-section-header">Your Contacts</div>
          <div id="contactsList"></div>
          <div class="msg-no-contacts" id="noContactsMsg" style="display: none;">
            No contacts yet. Discover characters through feeds and apps.
          </div>
          <button class="msg-back-btn" id="contactsBackBtn">&larr; Back to Inbox</button>
        </div>

        <!-- THREAD VIEW (conversation with one person) -->
        <div id="messagesThread" style="display: none;">
          <button class="msg-back-btn" id="threadBackBtn">&larr; Back to Inbox</button>
          <div id="threadMessages"></div>
          <div class="msg-reply-bar">
            <input type="text" class="msg-reply-input" id="msgReplyInput" placeholder="Type a message..." maxlength="500">
            <button class="msg-send-btn" id="msgSendBtn">Send</button>
          </div>
        </div>

      </div>
    </div>

    <!-- Inventory App -->
    <div class="app-view" id="app-inventory">
      <div class="app-titlebar">
        <button class="app-home-btn" data-home>&larr; Home</button>
        <span class="app-titlebar-name">Inventory</span>
      </div>
      <div class="app-body">
        <div class="placeholder-content">
          <div class="placeholder-icon">&#127890;</div>
          <h3>Coming Soon</h3>
          <p>Your items, gear, and possessions. Anything you pick up or get rewarded shows up here.</p>
        </div>
      </div>
    </div>

    <!-- Notebook App -->
    <div class="app-view" id="app-notebook">
      <div class="app-titlebar">
        <button class="app-home-btn" data-home>&larr; Home</button>
        <span class="app-titlebar-name">Notebook</span>
      </div>
      <div class="app-body">
        <div class="placeholder-content">
          <div class="placeholder-icon">&#128221;</div>
          <h3>Coming Soon</h3>
          <p>Saved notes, clues, and intel. Tap a note to read its contents. Your eyes only.</p>
        </div>
      </div>
    </div>

    <!-- Profile App -->
    <div class="app-view" id="app-profile">
      <div class="app-titlebar">
        <button class="app-home-btn" data-home>&larr; Home</button>
        <span class="app-titlebar-name">Profile</span>
      </div>
      <div class="app-body">

        <!-- Hero identity -->
        <div class="profile-identity">
          <h3 id="profileHeroName">Loading...</h3>
          <p id="profileHeroClass" class="profile-class"></p>
        </div>

        <!-- 4 Aggregate scores (top, prominent) -->
        <div class="aggregate-grid" id="aggregateGrid">
          <div class="aggregate-card agg-followers">
            <div class="aggregate-value" id="aggFollowers">—</div>
            <div class="aggregate-label">Followers</div>
          </div>
          <div class="aggregate-card agg-networth">
            <div class="aggregate-value" id="aggNetWorth">—</div>
            <div class="aggregate-label">Bank</div>
          </div>
          <div class="aggregate-card agg-authority">
            <div class="aggregate-value" id="aggAuthority">—</div>
            <div class="aggregate-label">Authority</div>
          </div>
          <div class="aggregate-card agg-clout">
            <div class="aggregate-value" id="aggClout">—</div>
            <div class="aggregate-label">Clout</div>
          </div>
        </div>

        <!-- Section divider -->
        <div class="profile-section-label">Base Skills</div>

        <!-- 6 Base skills (below, different style) -->
        <div class="skills-grid" id="skillsGrid">
          <div class="loading"><div class="spinner"></div></div>
        </div>

      </div>
    </div>

  </div>

  <!-- Character Profile Popup (accessible from anywhere) -->
  <div class="char-popup-overlay" id="charPopupOverlay" style="display: none;">
    <div class="char-popup">
      <button class="char-popup-close" id="charPopupClose">&times;</button>
      <!-- Large character image sits flush at top of card -->
      <div class="char-popup-avatar" id="charPopupAvatar">?</div>
      <!-- Info, bio, and actions sit below with padding -->
      <div class="char-popup-body">
        <div class="char-popup-info">
          <h3 id="charPopupName">Loading...</h3>
          <p id="charPopupRole"></p>
          <p id="charPopupFaction"></p>
        </div>
        <p class="char-popup-bio" id="charPopupBio"></p>
        <div class="char-popup-actions">
          <button class="btn btn-primary char-popup-btn" id="charSendMsgBtn">Send Message</button>
          <button class="btn btn-secondary char-popup-btn" id="charAddContactBtn">Add to Contacts</button>
        </div>
        <div class="char-popup-status" id="charPopupStatus"></div>
      </div>
    </div>
  </div>

  <!-- Faction Popup (opens when a faction name is clicked) -->
  <div class="faction-popup-overlay" id="factionPopupOverlay" style="display: none;">
    <div class="faction-popup">
      <button class="faction-popup-close" id="factionPopupClose">&times;</button>
      <!-- Banner image — shown when faction has banner_url set via admin portal -->
      <img class="faction-popup-banner" id="factionPopupBanner" src="" alt="" style="display: none;">
      <div class="faction-popup-header">
        <div class="faction-popup-name" id="factionPopupName">Loading...</div>
      </div>
      <div class="faction-popup-body">
        <p class="faction-popup-desc" id="factionPopupDesc"></p>
        <div class="faction-popup-leader-row" id="factionPopupLeaderRow" style="display: none;">
          <span class="faction-popup-label">Leader</span>
          <span class="faction-popup-leader-name clickable-name" id="factionPopupLeader"></span>
        </div>
        <div class="faction-popup-members-section" id="factionPopupMembersSection" style="display: none;">
          <div class="faction-popup-label">Members</div>
          <div id="factionPopupMemberList"></div>
        </div>
        <div class="faction-popup-status" id="factionPopupStatus"></div>
      </div>
    </div>
  </div>

  <!-- Mission Overlay — full-screen, covers the terminal while a mission is active -->
  <div class="mission-overlay" id="missionOverlay" style="display: none;">

    <!-- Top: large image area -->
    <div class="mission-image-area" id="missionImageArea">
      <img class="mission-current-image" id="missionCurrentImage" src="" alt="" style="display: none;">
      <!-- Flavor text shown briefly after each choice -->
      <div class="mission-flavor" id="missionFlavor"></div>
    </div>

    <!-- Panel 1: Question (shown while answering questions) -->
    <div class="mission-question-panel" id="missionQuestionPanel" style="display: none;">
      <div class="mission-question-num" id="missionQuestionNum"></div>
      <div class="mission-question-text" id="missionQuestionText"></div>
      <div class="mission-options" id="missionOptions"></div>
      <button class="mission-abandon-btn" id="missionAbandonBtn">Abandon Mission</button>
    </div>

    <!-- Panel 2: Confirm submit (shown after final question) -->
    <div class="mission-confirm-panel" id="missionConfirmPanel" style="display: none;">
      <div class="mission-confirm-title">Submit Mission?</div>
      <div class="mission-confirm-text">Your choices are locked in. This cannot be undone.</div>
      <div class="mission-confirm-actions">
        <button class="btn btn-primary" id="missionConfirmBtn">Submit</button>
        <button class="btn btn-secondary" id="missionConfirmCancelBtn">Cancel</button>
      </div>
      <div class="mission-submit-status" id="missionSubmitStatus"></div>
    </div>

    <!-- Panel 3: Outcome (shown when DM marks resolved = yes) -->
    <div class="mission-outcome-panel" id="missionOutcomePanel" style="display: none;">
      <div class="mission-outcome-label" id="missionOutcomeLabel"></div>
      <div class="mission-outcome-narrative" id="missionOutcomeNarrative"></div>
      <div class="mission-outcome-changes" id="missionOutcomeChanges"></div>
      <button class="btn btn-primary" id="missionOutcomeCloseBtn">Close</button>
    </div>

  </div>

  <script src="js/sheets.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/dashboard.js"></script>
</body>
</html>
